JQuery плагин слайдера диапазона - [посмотреть](https://maximshmatov.github.io/slider/) 
========

Данный проект представляет собой JQuery плагин слайдера диапазона,
который позволяет перетягиванием ползунков задавать какое-то целое числовое значение.
Он реализован в рамках программы обучения программированию,
но сгодится и для применения в производстве.

Основной технологический стек:
**JavaScript ES6, TypeScript, WebComponents, Jasmine, Karma.**

### Обзор  

1. Плагин имеет удобное API для подключения его к элементам на странице. 
Подключение происходит за счет замены искомого HTML элемента.
2. Плагин может быть инициализирован: 
    * из JS-объекта;
    * из HTML-элемента;
3. Доступны следующие опции плагина:
    * минимальное и максимальное значение;
    * размер шага;
    * вид (вертикальный или горизонтальный);
    * одиночное значение или интервал;
    * включать и отключать показ текущего значения над бегунком;
    * включать и отключать шкалу допустимых значений.
4. Стили плагина вынесены в отдельный файл, и это позволяет менять его дизайн и оформление.

### Клонирование репозитория и установка зависимостей:

Следующие команды требую наличие установленной Node.js v.14 и git 2.27.

`git clone https://github.com/MaximShmatov/slider.git` - клонирует репозиторий.

`npm install` - устанавливает зависимости.

### В директории проекта доступны следующие скрипты:

`npm start` - запускает проект в режиме разработки. 
Откройте [http://localhost:9000](http://localhost:3000) для просмотра в браузере.

`npm run build` - запускает производственную сборку проекта.

`npm run test` - запускает тестирование компонентов.

`npm run lint` - запускает линтер.

`npm run deploy` - публикация проекта на github pages.

### Подключение

```html
<script type="text/javascript" src="RangeSlider/SliderPlugin.js"></script>
```
или
```javascript
import 'range-slider/SliderPlugin.js';
```
### Инициализация
* **Инициализация из HTML кода:**
```haml
<div id="slider" data-min-value="-10" data-max-value="100" data-value-from="0" data-step-size="1"></div>
```
* **Инициализация из JS кода:**
```javascript
$('#range-slider').slider('init');
```
или
```javascript
$('#range-slider').slider('init', {
    minValue:-10,
    maxValue: 100,
    valueFrom: 0,
    valueTo: 10,
    stepSize: 1,
    isRange: true,
    isVertical: true,
    hasTooltip: true,
    hasScale: true,
});
```
### Установка / получение свойств

```javascript
$obj = jQuery('#range-slider').slider('init');
$obj.slider('minValue', '10');
const minValue = $obj.slider('minValue'); // minValue = 10
```
или
```javascript
$obj = jQuery('#range-slider').slider('init');
$obj.slider('all', {
  minValue: 0,
  maxValue: 100,
  valueFrom: 50,
  hasTooltip: true, 
});
const minValue = $obj.slider('all'); // minValue = {}
```

Архитектура
--------------

Плагин реализован на посредством TypeScript с применением шаблона проектирования MVP.  
Тесты к плагину прилагаются, и используют фреймворки Jasmine и Karma. 
Состав компонента плагина:
* Model.ts - класс модели с логикой валидации свойств; 
* View.ts - основной класс view компонента; 
  * ViewScale - класс шкалы;
  * ViewRail - класс рельса;
  * ViewProgress - класс шкалы прогресса;
  * ViewThumb - класс бегунка;
* Presenter.ts - класс контроллера (презентера),
  реализует API плагина (инициализация, установка и чтение опций);
* RangeSlider.ts - собственно сам плагин. Присоединяет функцию "Slider" к JQuery объекту;
* styles.module.sass - стили плагина. Также содержит модификаторы для вертикального состояния;
* index.d.ts - файл деклараций. Содержит интерфейсы и определения типов;

### Класс Model

Содержит методы установки и чтения свойств. 
Также содержит функцию (callback), которая вызывается в случае изменения значения свойства.
Для инициализации плагина модель может принимать объект (HTMLElement | FormData | ISliderData). 
При установке свойства, сеттеры проверяют переданное им значение на корректность 
(установка значения проходит валидацию). Объект модели представлен следующими свойствами:
* minValue: number - минимальное значение;
* maxValue: number - максимальное значение;
* valueFrom: number - текущее значение (если "onRange = true", то начальное значение);
* valueTo: number - если "onRange = true", то конечное значение, иначе игнорируется;
* stepSize: number - размер шага. Размер шага не может быть меньше единицы;
* isRange: boolean - вкл/выкл диапазона слайдера;
* hasTooltip: boolean - вкл/выкл табло значения над бегунком;
* hasScale: boolean - вкл/выкл шкалу слайдера;
* isVertical: boolean - вкл/выкл вертикальное состояние;
* callback: function - функция обратного вызова;

### SliderView.ts

Файл содержит в себе реализацию "View" шаблона проектирования MVP, и содержит в себе пять классов веб-компонентов.
В случае изменения значения слайдера пользователем посредством перетаскивания бегунка,
генерирует событие "slider-view". Событие содержит в себе объект: "{name: string, value: number}".
В образовательных целях вид слайдера реализован посредством веб-компонентов и разбит на "subView".
Для поддержки браузерами веб-компонентов к "View" были подключены 
[полифилы](https://www.webcomponents.org/polyfills). Файл стилей импортируется как модуль.
Это исключает конфликт имен классов в случае, если на странице подключено несколько слайдеров.
"View" реализован посредством следующих классов:
* SliderView - агрегирует все кастомные элементы и встраивает их в ShadowRoot;
* Scale - представляет собой шкалу слайдера;
* Rail - реализует рельс по которому двигается ползунок;
* Progress - визуально выделяет текущее значение слайдера;
* Thumb - собственно, сам ползунок.
## Presenter.ts
Файл содержит в себе реализацию "Presenter" шаблона проектирования MVP. 
Презентер является связующим звеном между моделью и представлением. Устанавливает или читает свойства 
модели и затем обновляет вид.

**Сздание объекта класа "Presenter" происходит в следующем порядке:**
1. Создает объект модели и передает в неё функцию обратного вызова.
2. Создает пользовательский элемент "input-slider" и помещает в него ссылку на себя.
3. На созданный объект "view" устанавливает прослушку события "slider-view".

**Установка свойств слайдера или его инициализация происходит в следующем порядке:**
1. Вызывается метод установки свойства или инициализации модели.
2. Если значение свойства модели изменилось, вызывается функция презентера "observer".
3. Функция "observer" вызывает метод представления для установки нового значения атрибутов.
4. Функция "observer" генерирует событие "slider-data" для оповещения внешнего кода об изменениях.

**Реакция презентера на действия пользователя происходит в следующем порядке:**
1. Презентер слушает событие "slider-view" на представлении.
2. Извлекает из объекта события координаты бегунка и расчитывает значение слайдера.
3. Устанавливает в свойство модели расчитанное значение.
4. Генерирует событие "slider-data" для оповещения внешнего кода об изменениях.
## RangeSlider.ts
Файл содержит в себе код расщирения jQuery объекта перегруженой функцией "slider". 
Функция имеет следующие реализации:
* `slider(method: 'init'): JQuery` - возвращает jQuery объект с инициализированными элементами;
* `slider(method: TMethodsUnion): number | boolean | string` - возвращает значение свойства плагина;
* `slider(method: TMethodsUnion, prop: number | boolean | string): void` - устанавливает свойство плагина;
* `slider(): JQuery` - возвращает jQuery объект с ранее инициализированными элементами;
* `slider(method: 'init', prop: HTMLElement | ISliderData | FormData): JQuery` - инициализирует элементы 
из заданного объекта;

--------------
UML-диаграмма классов
--------------

![UML-диаграмма классов](diagram.png "UML-диаграмма классов")
